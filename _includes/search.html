<div id="bcc-search-wrapper">
    <label for="search_code_input">Search for code in <span>BCC-code</span></label>
    <div>

        <div id="search_suggestions_wrapper">
            <input type="text" name="searchCode" id="search_code_input" placeholder="Example: Widgets"
                   onkeyup="autoComplete()"/>
            <div id="search_suggestions-section">
                <ul id="search_suggestions"></ul>
            </div>
        </div>

        <button onclick="searchOnClickFunction()" class="btn-search">
            <span>Search Github</span>
        </button>
    </div>
</div>

<script type="module"></script>

<script>


    function autoComplete() {
        let input, filter, suggestionWrapper, suggestion, a, i;
        input = document.getElementById("search_code_input");
        filter = input.value.toUpperCase();
        suggestionWrapper = document.getElementById("search_suggestions");
        suggestion = suggestionWrapper.getElementsByTagName("li");
        for (i = 0; i < suggestion.length; i++) {
            a = suggestion[i].getElementsByTagName("a")[0];
            if (a.innerHTML.toUpperCase().indexOf(filter) > -1) {
                suggestion[i].style.display = "";
            } else {
                suggestion[i].style.display = "none";
            }
        }
    }

    function searchOnClickFunction() {

        const searchCode = document.getElementById("search_code_input").value;
        const searchUrl = "https://github.com/search?q=org%3Abcc-code+" + searchCode;

        console.log(searchUrl);
        window.location.href = searchUrl;

    }

    function updateAndSearch(repoName, fileUrl) {
        document.getElementById("search_code_input").value = repoName;
        console.log(fileUrl);
        window.location.href = fileUrl;
    }

    let markdownNameArray = [];
    let markdownUnusedArray = [];

    async function listMarkdownFiles() {
        const getMarkdownFilesUrl = `https://api.github.com/search/code?q=language:markdown+org:bcc-code&per_page=100&sort=stars`;

        const getMarkdownData = await fetch(getMarkdownFilesUrl)
            .then(response => response.json())
            .catch(error => console.log(error));

        console.log(getMarkdownData);

        for (let data of getMarkdownData.items) {
            const markdownRepositoryData = data.repository;
            const markdownRepositoryName = markdownRepositoryData.name;
            const markdownFileName = data.name;
            const markdownFileUrl = data.html_url;
            const displayName = `${markdownRepositoryName}/${markdownFileName}`

            if (markdownNameArray.includes(displayName)) {
                continue;
            } else {
                markdownNameArray.push(displayName);
                console.log(markdownNameArray)
            }

            const createListItem = document.createElement("li");
            const searchSuggestions = document.createElement("a");
            searchSuggestions.className = "search_suggestion";
            searchSuggestions.setAttribute("onclick", `updateAndSearch('${markdownFileName} ',' ${markdownFileUrl}')`);
            searchSuggestions.innerText = `${displayName}`;

            const newElementLocation = document.getElementById("search_suggestions")
            newElementLocation.appendChild(createListItem).appendChild(searchSuggestions)

        }


    }

    document.onload(listMarkdownFiles());

</script>